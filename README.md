# 2020-Verilog-final 蓝牙控制移动接物游戏数字系统
## 简述

2020年数字逻辑课程综合实验，一个基于FPGA、蓝牙从模块、声音传感器、vga显示屏的接随机掉落物体计分小游戏。~~（一周年解禁版）~~

## 外设部件

- `Nexys 4 DDR Artix-7`——由 `Xilinx` 公司开发出的一款现场可编程门阵列（`FPGA`） 开发板。

- `VGA` 接口显示器 —— VGA (Video Graphics Array) 是 `IBM` 在 1987 年随 PS/2 机一起推出的一种 视频传输标准，具有分辨率高、显示速率快、颜色丰富等优点；

- `Bluetooth Slave UART Board` ——基于 `URART` 接口的蓝牙从模块，应用于无线蓝牙数据传输。

- `LM386` —— 是一种音频集成功率放大器，具有自身功耗低、更新内链增益 可调整、电源电压范围大、外接元件少和总谐波失真小等优点。主要应用于 低电压消费类产品。

## 系统框架

各模块共用一个顶层控制器：

1. 图片存储调用了 `IP` 核用于存储游戏素材。
2. 时钟分频模块块调用了 `IP` 核，用于将板内时钟分频；但似乎 `clocking wizard` 有分频范围的限制，我又根据需要手写了分频器。
3. 蓝牙模块实现与手机的交互，获取手机端发送的指令，从而达到游戏操作的效果。
4. VGA显示模块与显示屏交互，控制图片的显示和不同页面的切换。
5. 七段数码管：初始状态下显示作者学号，在游戏过程中根据游戏进程显示错失值、得分、以及生命值的十进制值。
6. 三色led灯：当游戏过程中小人接住下落物体时LD16闪物体同色的蓝绿光，而错失物体时闪红光。
7. 声音传感器：当错失第4个物体时，声音传感器使能信号有效，感知周围的声音达到一定强度且持续一段时间后，增加一生命值，计数生命值达到3时停止。

## 模块建模
1. 顶层模块 `top` ：用来统一协调各子系统，提供与外设间的接口，方便各模块之间的数据传输和与外设的交互。
2. 顶层控制器 `controller` ：根据子系统反馈信号完成状态转移。
3. 蓝牙模块` bt_control` ：蓝牙模块利用的是 `UART` 协议进行传输，此蓝牙模块支持的是 8 位数据位，一位停止位，无奇偶校验位，波特率为默认的 9600 ，配对密码 1234 同时为了保证传输数据的有效，加了滤波处理模块，传入的时钟为 100Mhz 既可。
4. `vga` 显示屏模块 `play_screen` ：用于显示图像信息，下有子模块 `vga_control` 和 `vga_display` ， `vga_control` 用于控制 `vga` 时序， `vga_display` 处理像素输出。
5. 七段数码管模块 `display7` ：负责开发板七段数码管的输出，选用板子上的控制信号来达到视觉上每一位显示不同数字的目的。
6. 三色 `led` 灯模块 `tri_color` ：根据得分和错失物体计数的变化情况，当得分时闪蓝绿光，未接中物体时闪红光。
7. 声音传感器模块 `sound` ：用于复活小人（错过 3 个物体后会失败，游戏中断，需复活才能继续）。声音传感器有效时，检测周围达到一定音量强度后持续一定时间后（基准 0.05s ）计数加一。

## 详细介绍
见报告。


